$(document).ready(function () {

	var lazyLoadInstance = new LazyLoad({
		elements_selector: ".lazy"
		// ... more custom settings?
	});

  var isDev = false;

	/*
	/ Обновление активного блока в прайсе и портфолио
	*/
  function setPriceTab() {
    var activePricePosition = $('.price_nav__item.active');
    $(".team_list__item").removeClass("active").eq(activePricePosition.index()).addClass("active");
  };

  function setWorkTab() {
    // Загрузка первого таба при загрузке страницы
    var activeWorkPosition = $('.works_nav__item.active'),
      urlActiveTab = activeWorkPosition.attr('data-tab');
    $.ajax({
      url: '/tools/sm-rem/tabs/' + urlActiveTab + '.html',
      cache: false,
      success: function (html) {
        $(".works_list").empty().html(html);
        iexForms.init();
      }
    });
  }
  setPriceTab();
  setWorkTab();

	/*
	/ Обнуляет позицию скролла при загрузке
	*/
  function scrollTopReset() {
    $('body').height($(window).height() * 2);
    $(window).scrollTop(0);
    $('body').height('');
  }
  scrollTopReset();

	/*
	/ Бинд скролл-апа по кнопке
	*/
  function bindScrolltopButton() {
    $('.scrollTo').click(function (event) {
      event.preventDefault();
      var target = $($(this).attr('href')),
        offset = 0;
      if (target.length) {
        offset = target.offset().top;
      }
      $('html, body').animate({ scrollTop: offset }, 500);
      $('.menu').removeClass('-active')
      setTimeout(
        function () {
          $('.menu').removeClass('-display')
        }, 500
      )
    });
  }
  bindScrolltopButton();

	/*
	/ Чек юрла на наличие ютм меток
	*/
  function cheackUtmHash(urlVars) {
    if (urlVars == undefined || false || ' ')
      urlVars = window.location.search;
    var VarArray = [],
      valueAndKey = [],
      resultArray = {};
    VarArray = (urlVars.substr(1)).split('&');
    if (VarArray[0] == "") return false;
    VarArray.forEach(function (element, i) {
      valueAndKey = VarArray[i].split('='),
        resultArray[valueAndKey[0]] = valueAndKey[1];
    });
    if (JSON.stringify(resultArray) === '{}') return false;

  }
  cheackUtmHash();


	/*
	/ Функция инкапсуляции времени пользователя
	*/
  function getCurrentTime() {
    var newDataObject = new Date(),
      currentHour = newDataObject.getHours();

    changeAcctualColorForNumber(currentHour);
  };
  getCurrentTime()


	/*
	/ Бинд всех кнопок/ссылок
	*/
  function bindAllClickFunction() {
		/*
			Смена табов в прайсе для мобильных
		*/
    $('.mbox_title').click(function () {
      $(this).parent().toggleClass('active')
    })

    $('li.more').click(function () {
      $(this).parent().toggleClass('active')
    })

    $('li.hidden').click(function () {
      $(this).parent().toggleClass('active')
    });

		/*
		Смена табов в прайсе для пк
	*/
    $('.btn-drop').click(function () {
      var data = $(this).attr('data-drop');
      $('.' + data).toggleClass('show');
    });

		/*
			Смена табов в прайсе для мобильных
		*/
    $('.price_mnav__link').click(function (e) {
      e.preventDefault();
      $('.price-drop:first-of-type').text($(this).text());
      $(".price_tabs__item").removeClass("active").eq($(this).index()).addClass("active");
      $('.price_mnav').removeClass('show')
    });

		/*
			Активация меню
		*/
    $('.hambuger').click(function () {
      $('.menu').addClass('-display')
      setTimeout(
        function () {
          $('.menu').addClass('-active')
        }, 1
      )
    });

    $('.menu-close').click(function () {
      $('.menu').removeClass('-active')
      setTimeout(
        function () {
          $('.menu').removeClass('-display')
        }, 500
      )
    });

		/*
			Смена табов в прайсе для мобильных
		*/
    $(".price_nav__item").bind("click", function (e) {
      e.preventDefault()
      $(this).addClass("active").siblings().removeClass("active"),
        $(".price_tabs__item").removeClass("active").eq($(this).index()).addClass("active")
    });

		/*
			Смена табов в блоке "Команда" для мобильных
		*/
    $(".team_nav__item").bind("click", function (e) {
      e.preventDefault();
      $(this).addClass("active").siblings().removeClass("active"),
        $(".team_list__item").removeClass("active").eq($(this).index()).addClass("active");
      $('.team_list__item.active').slick({
        arrows: false,
        dots: true,
      })
    });
  };
  bindAllClickFunction();

	/*
	/ Запуск плагина для поп-ап видео
	*/
  function initCboxVideo() {
    $(".cbox_video").colorbox({ iframe: true, innerWidth: 640, innerHeight: 390 });

    if ($(window).width() < 575) {
      $(".cbox_video").colorbox({ iframe: true, innerWidth: 320, innerHeight: 195 });
    };
  };
  initCboxVideo();

	/*
	/ Инициализация iexForm
	*/
  function initIexForm() {
    (function () {
      if (typeof IexForms === 'undefined') return;

      var cbDefault = {
        /* form = {id, uid, $button, $wrap, config, callback, fieldsErrorPosition, extraPostParams } */
        'onLoad': function (form) { },
        'onSuccess': function (form) {
					fbq('track', 'Lead', {
						value: 1,
						currency: 'RUB',
					});
        },
      };

      let $messageButton = $('.js-pform-show[data-pform-id="manager-popup"]'); // показываем через 10сек и скрываем после отправки формы
    setTimeout(function () {
      $messageButton.addClass('active');
    }, 15000);

      var cbConsult = {
        'onHide': function (form) {
          $messageButton.removeClass('active');
        },
        'onSuccess': function (obForm) {
          $messageButton.removeClass('active');
					fbq('track', 'Lead', {
						value: 1,
						currency: 'RUB',
					});
        }
      };

      var formsParams = {
        'calc': { config: '/tools/sm-rem/libs/iexForm/index.php?config=multistep&template=calc', callback: cbDefault },
        'main-popup': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=name-phone', callback: cbDefault },
        'popup-hochu': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=master-popup', callback: cbDefault },
        'rassrochka-popup': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=rassrochka-popup', callback: cbDefault },
        'smetchik': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=smeta', callback: cbDefault },
        'scrollback': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=scrollback', callback: cbDefault },
				'manager-popup': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=manager-popup', callback: cbConsult },
        'master-popup': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=master-popup', callback: cbDefault },
        'smetchik-popup': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestep&template=smetchik-popup', callback: cbDefault },




        'calc-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=multistepspb&template=calc', callback: cbDefault },
        'main-popup-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=name-phone', callback: cbDefault },
        'popup-hochu-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=master-popup', callback: cbDefault },
        'rassrochka-popup-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=rassrochka-popup', callback: cbDefault },
        'smetchik-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=smeta', callback: cbDefault },
        'scrollback-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=scrollback', callback: cbDefault },
				'manager-popup-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=manager-popup', callback: cbConsult },
        'master-popup-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=master-popup', callback: cbDefault },
        'smetchik-popup-spb': { config: '/tools/sm-rem/libs/iexFormSpb/index.php?config=onestepspb&template=smetchik-popup', callback: cbDefault },



        'calc-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=multistepkzn&template=calc', callback: cbDefault },
        'main-popup-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=name-phone', callback: cbDefault },
        'popup-hochu-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=master-popup', callback: cbDefault },
        'rassrochka-popup-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=rassrochka-popup', callback: cbDefault },
        'smetchik-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=smeta', callback: cbDefault },
        'scrollback-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=scrollback', callback: cbDefault },
				'manager-popup-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=manager-popup', callback: cbConsult },
        'master-popup-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=master-popup', callback: cbDefault },
        'smetchik-popup-kzn': { config: '/tools/sm-rem/libs/iexForm/index.php?config=onestepkzn&template=smetchik-popup', callback: cbDefault },

      };

      window.iexForms = new IexForms(formsParams);
    })();

    iexForms.init();
  };
  initIexForm();

	/*
	/ Смена точки у номера в зависимости от времени
	*/
  function changeAcctualColorForNumber(item) {
    if (item >= 22 && item <= 9) {
      $('.header .header_nav .header_numbers__tel a').addClass('red')
    } else {
      $('.header .header_nav .header_numbers__tel a').removeClass('red')
    }
  };

  $(".b-message").swipe({
    swipe: function (event, direction, distance, duration, fingerCount, fingerData) {
      if (direction == 'up') {
        $('.b-message').removeClass('active')
      }
    }
  });

	/*
	/ Ajax загрузка галлереи
	*/
  function ajaxLoadWorks() {
    $('.works_nav__item').click(function (e) {
      e.preventDefault();
      $('.works_nav__item').removeClass('active');
      $(this).addClass('active');
      var pathToFile = $(this).attr('data-tab');
      $.ajax({
        url: '/tools/sm-rem/tabs/' + pathToFile + '.html',
        cache: false,
        success: function (html) {
          $(".works_list").empty().html(html);
          iexForms.init();
        }
      });
    });

    $('.works_mnav__link').click(function (e) {
      e.preventDefault();
      $('.works-drop:first-of-type').text($(this).text());
      var pathToFile = $(this).attr('data-tab');
      $.ajax({
        url: '/tools/sm-rem/tabs/' + pathToFile + '.html',
        cache: false,
        success: function (html) {
          $(".works_list").empty().html(html);
          iexForms.init();
        }
      });
      $('.works_mnav').removeClass('show')
    });
  };
  ajaxLoadWorks();

	/*
	/ Инициализация плагинов
	*/
  function plugInit() {
    $(document).on('scroll', function () {
      if ($(this).scrollTop() > 200) {
				$('.header').addClass('-offset');
				$('.mmenu-fluid').addClass('-offset')
      } else {
				$('.header').removeClass('-offset');
				$('.mmenu-fluid').removeClass('-offset')
      }
    });

    $('.pic-cbox').colorbox({
      width: '90%',
      height: '90%'
    });

    $('.team_list__item-1').slick({
      arrows: false,
      dots: true,
    });
  };
  plugInit();

	/*
	/ Смена значения input в шапке в зависимоти от range
	*/
  function headerCalc() {
    $('.inp_range_2').on("change mousemove", function () {
      $('.head_form__count2').val($(this).val());
    });
    $('.inp_range_1').on("change mousemove", function () {
      $('.head_form__count1').val($(this).val());
    });

    $('.head_form__count2').on("change", function () {
      $('.inp_range_2').val($(this).val());
    });
    $('.head_form__count1').on("change", function () {
      $('.inp_range_1').val($(this).val());
    });
  };
  headerCalc();

  // $(document).scroll(function(){
  //   var t = $(this), 
  //       st = t.scrollTop(),
  //       ih = t.height(),
  //       hih = ih / 2;

  //   console.log(st,ih,hih)
  //   if ( st > hih ) $('.smeta-pop').addClass('--active');
  // })


  // $('.smeta-btn').click(function () {
  //   $('.smeta-pop').addClass('--form')
  // })

  // $('.smeta-pop-btn-close').click(function () {
  //   $('.smeta-pop').removeClass('--active').css("display", "none")
  // });

  $('.scrollback-btn-close').click(function () {
    $('.scrollback').removeClass('active').addClass('closed');
    $('body').css('overflow', 'scroll')
  })

  $(window).bind('mousewheel DOMMouseScroll MozMousePixelScroll', function (event) {
    delta = parseInt(event.originalEvent.wheelDelta || -event.originalEvent.detail);
    if ($(this).scrollTop() > ($(document).outerHeight() / 1.5) && delta >= 0) {
      $('.scrollback').addClass('active')
      if (!($('.scrollback').hasClass('closed'))) {
        $('body').css('overflow', 'hidden')
      }

    }
  });

  $('.service_nav__item').click(function () {
    $(this).addClass("active").siblings().removeClass("active"),
      $(".new-slide").removeClass("active").eq($(this).index()).addClass("active")
  })


}) 